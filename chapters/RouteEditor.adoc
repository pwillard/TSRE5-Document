== Route Editor

=== Before Getting Started

_Some comments in case you just jump right to to this section_

To start working with the Route Editor you need to:

* Download and run the TSRE5 application
* Have at least one populated train simulator *gameRoot* or *Root Directory* to refer to

[NOTE]
 A `gameRoot` must be one of the following items:

* An MSTS root directory
* An {OR} installation profile
* A Mini Route directory
* Any other Directory that contains populated "global", "routes" and "trains" folders 

[WARNING]
  If you haven't done this by now, please make sure that you are running any instances of MSTS outside of system managed folders like `c:\program files(x86)`.  This means that you didn't accept the default folder options when installing MSTS from CDROMS.  It is recommended that a root directory for MSTS be used, like `C:\MSTS`.  This installation location would be one of your possible `gameRoot` locations.


=== Overview

* _(Optional)_ Set the `gameRoot` value in the application settings to your desired Root Directory. See: <<settings>>

* Open the `TSRE5` executable, or the `TSRE5x32` executable if you are using a 32 bit version of Windows

[IMAGE]
image::images/re1.png[]

If you have properly set up the `gameRoot` settings then the {RE} is ready to use.  


<<<<
[#begin]
=== Starting a Session

If you want to use the {RE}, simply open the TSRE5 executable. By default, the *Route Editor* features will be available.  The *Activity Editor* is also available from within the {RE}.

[NOTE]
 If you want to use *Consist Editor*  however, you need to use the `ConsistEditor.bat` file to start a Consist Editing session.

[IMAGE]
image::images/intro3.png[]


=== Loading a Route

If you have not defined a default "gameRoot" setting, you will need to click the *browse* button and select your game directory every time that TSRE is loaded. It can be any directory that contains `Routes`, `Trains` and `Global` folders such as the standard MSTS installation folder, or a mini route folder.

[IMAGE]
image::images/lr1.png[]

You can also select from your "recently used" folders if you have had previous {RE} sessions.

[IMAGE]
image::images/lr2.png[]

Select the route you want to edit and click `Load`

[IMAGE]
image::images/lr3.png[]




<<<<
[#newroute]
=== Creating A New Route

Click the `New` button

[IMAGE]
image::images/ren1.png[]

Enter the name to use as a *Route Name ID*. This will become the route's directory name and is used for the naming of key files. It is a good practice to enter a short, lowercase name with no spaces.

Enter the Latitude and Longitude of the World coordinates where you want to start the new Route. If it will be a fictional route, you can use default values. 

[WARNING]
  The values entered need to be valid Latitude and Longitude coordinate values, otherwise {RE} will crash. 

[IMAGE]
image::images/ren2.png[]

To find the Latitude and Longitude of the location you want to work in, you can use Google Maps.

[IMAGE]
image::images/ren4.png[]

Click *OK* button.

You can now edit the Route Settings. You can also click *OK* here and come back to update these values later.

[IMAGE]
image::images/ren3.png[]

Display name:: The Route name. 
Description::  The Route description.

Electrified:: Yes/No option to choose if tracks have electricity.
Wire Height:: The overhead line height. 

[NOTE]
The default MSTS/{OR} wire is visually unpleasing and many route builders ignore this value.


Max Voltage:: The overhead line voltage.

Start Tile:: The {RE} will start at this world position. Changing these values is not recommended while creating new route.

[IMAGE]
image::images/ren4.png[]

You can now begin editing your new route.

<<<<
[#mainwindow]
=== Getting Around in the Route Editor

*Main Window*


[IMAGE]
image::images/rec1.png[]

[#menu]
==== Menu

`Route->Save`:: Save changes.
`Route->Create Debug Paths`:: Delete all existing paths and create new simple paths for each track end node. You can use it to test route in OR without manually creating paths. If route has custom paths - make backup first!
`Route->Edit Route settings`:: Edit route settings (TRK file) in new window.
`Route->Exit`:: Close the route editor.

`Edit->Undo`:: Undo last action kbd:[CTRL+Z].
`Edit->Copy`:: Copy selected object kbd:[CTRL+C].
`Edit->Paste`:: Paste selected object kbd:[CTRL+V].
`Edit->Select Tool`:: Select oblect kbd:[E].

`View`:: show/hide route objects.

`Tools->Properties`:: show/hide properties tab.
`Tools->NaviWindow`:: show/hide navigation window.
`Tools->`kbd:[F1] `- Tools->`kbd:[F12]:: Choose a tool-set to work with.

`Help->About`:: show app info.

==== Properties

Shows the selected object's properties.

==== Tools

Tools you can use to edit your route. The list adjusts to context.

==== Route View  
Shows the route visuals.


<<<

[#editor]
=== Using the Editor

kbd:[F1] ... kbd:[F12]::    Choose a tool-set.
kbd:[Ctrl-Shift-S]::   Save the route
kbd:[B]::   Create new Tile at current position

[IMAGE]
image::images/rec4.png[]

==== General Navigation

===== Navigating Keys

kbd:[AWSD] (and *Arrows* if `UseNumPad=False in 'settings.txt'`)::  Move left, right, front, back.

* Min Speed is keyboard arrow keys + kbd:[Ctrl] key.
* Std Speed is keyboard arrow keys.
* Max Speed is keyboard arrow keys + kbd:[Shift] key.
* Move up kbd:[W-Spacebar], Move down kbd:[S-Spacebar].

kbd:[.] (Period Key):: Top Down View. Press to toggle on/off

See Camera Speed Presets in <<settings>>

You can easily jump to many locations in your route using Navi Window.
[IMAGE]
image::images/navitravel.png[]

1. Select from one of the many categories, for example Route: Sidings.
2. Select siding.
3. Click Jump.

[TIP] 
 Press kbd:[LMB] left mouse button and move mouse to look around.

<<<
[#keyboard]
===== Keyboard

[IMAGE]
image::images/rec3.png[]

Keyboard has two layouts depending on the setting in the `settings.txt` file.

1. If `useNumPad = true` TSRE assumes you have a number pad
2. If `useNumPad = false` TSRE assumes you will use the Arrow Keys

[TIP]
 Remember: kbd:[Ctrl + Z] will *Undo* the last operation.  This is probably the most important tip you should remember.
 

<<<

[#naviwindow]
=== Navi Window 

[TIP] Due to map projection issues, using actual LAT/LONG values may not be 100% accurate.  It is recommended that MARKERS from Google Earth (saved as KML files) be used as jump references.  Some people have found that determining the *offset* for the route area is handy.  For example; adding approx 100 to the ingame compass latitude reading and subtracting approx 150 from the longitude and then inputting those figures into the navi window gets me near enough to work with. eg: a lat fig of 48.0785 up to 48.0883 and lon -82.1266 down to -82.1113.

The Navi Window is a separate movable window that allows coarse adjustments of position with the {RE}. It can take input from Traditional Marker Files (MKR), Google Earth Keyhole Markup Language (KML) files and Open Street Map (GPX) files.

If desired, it will accept Latitude and Longitude values or any existing Route entities that have been defined. 

[IMAGE]
image::images/naviwindow.png[]

*Using Lat/Long, Marker files, GPS position files, or object placements in the Navi Window*

Example 1:: 
Select a file from the pull down list in the navi windows (You can use MKR, KML, GPX) and select item from the file for a location to go to. _See <<realistic>>_

Example 2::
The Navi Window will show the current world Lat/Long position. You can enter a specific Lat/Long position you want to go to 

Example 3:: Select a category from the categories list, like *Route: Sidings*. Select a *siding*.

When you have entered the desired position you wish to be moved to, Select `Jump` to go there.

[IMAGE]
image::images/rec2.png[]

[NOTE]
  The Navi Window will also show the current tile object count and removed object count. 

[TIP]
If your camera is looking down on terrain, you would also be flying down to terrain by using the arrow-key to move forward. If you press the period-key  kbd:[.] ( dot ), you are flying horizontally, and the camera is looking down. By pressing dot `.` a second time, you will get the standard-function back.

<<<



=== Working With Objects:

kbd:[Q]:: Place a new object.
kbd:[Ctrl + Q]:: Toggle the "manual/auto" `add track to TDB` option (use kbd:[Z] key for manual).
kbd:[Shift + Q]::  Change the placement mode: stick only to terrain / stick to everything.

[IMAGE]
image::images/rec5.png[]


The TSRE5 Objects Panel has a search function. With it, you can search on any part of a shape's filename.

[IMAGE]
image::images/SearchFunctionTSRE.jpg[]




[TIP]
In TSRE, when laying track inside tunnels, use: kbd:[Shift + Q]. It will change the placement mode between "stick only to terrain" and "stick to everything". Then you will then be able to stick the new track to the existing track that is under the terrain.

<<<
==== Object Placement Keys

kbd:[E]:: Select

kbd:[R]:: Rotate
kbd:[T]:: Translate / Transform
kbd:[Y]:: Scale. Use for example with transfers, dynamic tracks

kbd:[Numpad keys] + kbd:[pgup] / kbd:[pgdown]:: Use for *R/T/Y* if in keyboard layout 1 mode.
kbd:[Arrows] and kbd:[pgup] / kbd:[pgdown]::    Use *R/T/Y* if layout 2.

kbd:[X]:: Flip


kbd:[Ctrl]:: Change *R/T/Y* step slower.
kbd:[Alt]:: Change *R/T/Y* step faster.

kbd:[H]:: Adjust object position to terrain.
kbd:[N]:: Adjust object rotation to terrain.

kbd:[P]:: Pick object. You can pick existing object and place it in different place
kbd:[CTRL]:: Holding kbd:[CTRL] while "picking" will allow selection of multiple items
kbd:[C]:: Clone object. Creates object duplicate at the same position.
kbd:[Delete]:: Delete selected object.
kbd:[Mouse Scroll Wheel]::  Raise/Lower object after placing

[TIP]
In the TSRE `Tools` menu of the Objects window is a built-in ruler function.  When measuring mileposts in Real-World routes, use the Geo length rather than game length. It's remarkably fast to measure out 1600 meters, place a milepost, and move on to the next.  Make sure you delete the ruler objects when you're done. {OR} won't necessarily choke on them, but they will create errors in the log file if left

[TIP]
Translate operation should be performed first, before Rotate, as a Translate really drops shape's position down again, as it was placed originally.

<<<
==== Track Keys

kbd:[Z]:: add selected track to TDB.
kbd:[X]:: change new track position. Use before Z.
kbd:[F]:: adjust terrain to track. Use after Z. See more: Editing terrain.

==== Terrain Keys

kbd:[Z]:: change the terrain 'height-map' painting direction: *+* or *-*
kbd:[/]:: Toggle Terrain Collision mode.
kbd:[CTRL]:: Auto-Paint Mode
kbd:[CTRL+V,H]:: Toggle "Hide Terrain"


<<<

=== Placing Objects

How to place objects?

1. Select object type you want.
2. Select shape you want.
3. Click `Place New` button or kbd:[Q]

[IMAGE]
image::images/reo1.png[]

Click on the ground where you want new object.

You can use the Mouse Scroll wheel to Raise or Lower object after placing


[TIP]
Remember: using kbd:[Shift+Q] you can change placement mode between *stick only to terrain* or *stick to everything*.

[TIP]
Remember: kbd:[Ctrl + Z] will *Undo* the last operation.  
 
[TIP]
Holding the kbd:[Shift] key while dragging with the mouse will cause an object to rotate


==== Selecting Objects

You can select all objects using Select Tool. Enable it using:

* kbd:[E] key
* Right click -> *Select*
* Edit Menu -> *Select*
* Select button in kbd:[F1] Object Tools

Press and hold kbd:[CTRL] while selecting to select multiple items

==== Manipulating Objects

* kbd:[E] key
* Right click -> *Select*
* Edit Menu -> *Select*
* Use the kbd:[R] key to Rotate, kbd:[T] key to Transform, kbd:[Y] key to Scale

a. You can select object and move it around using mouse. Use mouse wheel to raise or lower its position. 
b. You can perform advanced translation by pressing kbd:[T] and using kbd:[4,6,8,2] keys to move in X and Z Axis, and kbd:[9,3] keys to move in Y axis.
c. You can adjust object rotation by pressing kbd:[R] and using kbd:[4,6,8,2] keys.
d. You can press kbd:[Ctrl] to change `R` & `T` step rate.

[NOTE]
 {DOT} Depending on your keyboard layout, you can use other keys. See: <<editor>>

[TIP] 
  When you rotate an object by use of the Copy/Paste or Transform button, be sure to re-select the object (even though it appears to be selected (blue outline)) by using the kbd:[E] key or the `Select` Button. This is to allow you to regain fine movement control when the `Ctrl` Key is pressed and held with the movement keys.


==== How to duplicate objects

There are multiple options for object duplication

* Select object and press kbd:[Ctrl+C], find place you want new object and press kbd:[Ctrl+V]
* Press kbd:[C] to clone object and make duplicate at the same position.
* Press kbd:[P] to pick object. Now you can click `Place New` button and place this object in a new location.

==== How to delete objects

* Select the object and press kbd:[Delete].


<<<<

==== Working with Track sections

The general sequence of steps for adding tracks is as follows.
 
1. Place the track
2. Adjust dynamic track properties
3. Save w/no TDB lines
4. Re-select track
5. Press kbd:[Z] for TDB 
6. Save

[TIP]
Having the {OR} *Track Viewer* tool open when using TSRE is a useful assistant when editing a route. It works fine even with a one monitor setup. Navigation becomes easy and tracking down errant TDB items too!

[WARNING]
----
Advice from Vince: A good rule to follow is NEVER move a track section if the `Yellow TDB` line appears above the track section.

Vince also says that a good track addition sequence is:
1. Place the track
2. Adjust the elevation, and for Dynamic Track, make "all" curve adjustments
3. Bring terrain to the track
4. Press the Z key to finally add your changes to the TDB
----

[TIP]
It is recommend you turn OFF `auto add to TDB` while adding / adjusting track and so prevent TDB corruption.

Adding tracks to the TDB *manually* will prevent all sorts of problems that will arise if a track is physically moved after it is added to the TDB.

You must be in `Select Mode` to toggle `auto-add TDB` OFF and ON using the kbd:[Ctrl+Q] key combination.  There is also an option you can set in the settings file.

[TIP]
When making _micro adjustments_ of the gradient are needed,  remember the `STEP` value in the Left Side Panel when the track is selected.  The Default setting is 25. This woks out to around 2.5 cm.  This value may be too large for any fine adjustments that are needed and you can set it to very small values.   Good values for finer control over adjustments would be 0.01 for some 'really small' adjustments.  The value can be reset in the `context menu` brought up by `right clicking` anywhere on the screen and selecting `Reset Move Step`. It will go back to the default value of 25.


[NOTE]
If you are having problems with a section, there is always kbd:[CTRL-Z] to undo.

*Dealing with Shape issues* 

image::images/TrackShape1.jpg[TDB Issue]

If you end up having issues with track section such as yellow TDB section but no track shape, there is hope.

Vince Says: 

* Delete the track sections on either end of the missing shape then attach a small track section to one end of the missing section; you can use a 30d tram curve but any short section will do.
* Save.
* Select the short section you just attached. At the bottom of the left side panel select `Hacks`.
* A `TrackObj Hacks` window opens.
* Select `Remove TDB Vector`. The yellow database lines above the missing track and the just added short section will go away.
* Select the short track section you previously added and kbd:[Delete] the track. 
* Save. Done!

[TIP]
When adding track I'd suggest keeping `auto-add to TDB` off. Press combo kbd:[Ctrl+Q] to toggle. _Sound familiar?_




==== Copying Tracks

You can duplicate an existing track by find the one you want, selecting it and then pressing kbd:[P].

Now you can click `Place New` and place this track at another location.

You can also select track and press kbd:[Ctrl+C] to copy it and then move to the location where you want add the new track and press kbd:[Ctrl+V] to paste it.

[IMAGE]
image::images/ret8.png[]


<<<




==== How to align objects to track

*Stick to track method*

* Click `Stick to track` checkbox.
* Click `Place New` button and place object you want on a track you want to align.

[IMAGE]
image::images/reo2.png[]

[IMAGE]
image::images/stick1.png[]

*Stick to Target*

1. Enable `Stick To Target`
2. Select "Snapable" target
3. If you want to see snapable points, you can enable `View->Snapable Points`
4. Place new object near snapable point. It will be adjusted to adjacent shape

[IMAGE]
image::images/snap1.png[]

For use when you need to align ANYTHING to track.

* Place a Check in the `Stick to Target` box.
* Any object placed within the distance specified in the *Snappable max radius field*, will align to the track.
* Set the size radius smaller to align objects in crowded areas.

{DOT} _This is set in the_ `Target Field Default` _setting is Tracks_

[TIP]
  This sure makes placing track-side equipment, bridges, platforms, gantries easy, even on curve!. Placed items will follow (align to) the track grade. If the alignment is off by 90 degrees,  use the `Rot Y 90` button. The correct gradient will follow the rotation! 

[TIP]
  Signals will automatically align to the track when placed except for direction. Use `Flip`  or kbd:[X] to change direction.

===== Modifying Track After Signals are Present

[Warning]
Generally, you just don't want to do this as it si fraught with danger.

As you can see in the picture below, the gantry sites empty, however, in MSTS activity Editor there *are* signals here. You can also see them  in the track monitor.

[IMAGE]
image::images/MISSING SIGNAL OBJECT IN TDB.jpg[]

So AE & Sim agree, there is a signal here but not visible. It is a 'Phantom' signal.

Using TSRE, I've found an easy way to remove them. Only problem is that it also fouls up any other signals on the same Track Vector and they need to be either replaced or most often, just relinked.

Actually,  the track section with the phantom on it does NOT need to be copy-delete-paste back-save. All you need do in TSRE with the track section selected is press kbd:[Z], which removes track from the TDB, then save. Re-select the track and press kbd:[Z] again (yellow tdb lines appear) then save to add track back to the TDB.




==== Copy Rotation

* Select track you want to get the rotation from.
* Click `Copy Rotation` button.
* Select object you want to set the rotation.
* Click `Paste Rotation` button.

[IMAGE]
image::images/reo3.png[]


[TIP]
When you rotate an object by use of the Copy/Paste or Transform button, be sure to re-select the object (even though it appears to be selected (blue outline)) by use of the 'E' key or Select Button. This is to allow you to regain fine movement control when the Ctrl Key is pressed and held with the movement keys.

=== Object Panels

==== Static Objects 



==== Forests 



==== Transfers 



==== Platforms and Sidings 

Place a siding or platform marker and fill in the properties for each item.

On the TSRE Objects Panel you would enter 'platform' and find the Platform marker you want.
Select it, place on track. Movement is about the same as MSTS. Use kbd:[2,4,6,8] keys to move them or you can drag w/mouse.


==== Roads

With the MSTS editor there was no choice when installing roads. If they were added to the route they got added into the Road Database file.

If you need short roads and some that would not be seen from a passing train having these roads without car spawners would result in taking up unnecessary space in the Road Database file and they serve no purpose other than to complicate the database file!

So why not just eliminate the database entry for these roads and leave them as static objects?

* METHOD *

With TSRE5, select the road for which you want to eliminate it's database entry. Press the kbd:[Z] key. The blue road database line vanishes. Save now and you're done.

The road section has been deleted from the routes RDB this leaving the road as a static object.

Note: To create roads without car spawners you can also use John Milligan's Dumb Roads. Just static scenery, no rdb entries.

==== Carspawners

To create a car spawner, you need an entry in the route's `REF` file like this. 

----
CarSpawner (
  Class (Vehicles)
  Description ("Car Spawner")
  StoreMatrix ()
)
----

[TIP] 
The class can be anything, I put mine in the "vehicles" class.


To add a car spawner, select it from the `REF` file list and then select `place new` as you would for any object. When you place it on the road section, you will see 2 purple squares ("handles"). Pull them apart and take note which direction the traffic is flowing. If it is going in the wrong direction, pull one handle past the other to reverse them.

When you select a handle, it changes to a lighter shade of purple and data for the spawner will display on the left side pane.

You may move the handles by either dragging with the mouse or by using the arrow keys. Selecting the `Expand` button on the left side pane expands the spawner to the extent of the road. 

[WARNING]
It is not recommended to have a car spawner longer than approximately 2 km.

The values for "car number" and "car speed" affect the speed and density of traffic. The car number refers to the average number of seconds between spawning a car so higher numbers mean less traffic such as for a rural road. A car number of 1 tends to produce vehicles so fast that they are sometimes bumper to bumper or worse. 

[TIP] 
The spawning mechanism randomizes vehicle appearance so this is just an average number.

Car speed is in meters per second. 60 mph is approximately 27 meters/sec. There is a conversion table at the back of the TSRE manual. Basically multiply mph by 0.447 to get meters per second. For kilometers per hour to meters per second multiply by 0.278.

If the car spawner handle refuses to cross a road joint it means that you do not have a good joint at that location and you wil need to remove the road sections and rebuild them. Road sections can be finicky to join especially multi lane highways that sometimes will want to join misaligned. Roads on a grade or over a bridge can be difficult. Try using shorter road sections and turning off "stick to terrain" (Shift-Q).

The cars spawned by the car spawner are defined by the `carspawn.dat` file in the root directory of your route. For MSTS there is only one car list. For {OR} you can define multiple car lists. This is useful when you want to have different cars for different roads or lanes of a road. For example on my 6 lane freeway I have cars and trucks in the right 2 lanes but cars only in the left lane, which is common in many US Interstates and freeways. To set up multiple car lists see *section 15.5* of the {OR} Manual.

[TIP]
Car spawners can also be used for walking people. Refer to *section 15.6* of the {OR} manual for more details.


<<<

==== Level Crossings

===== Simplifying Placement

Step 1:: Place your first interactive. Start with the gate shape. Use the NumPad arrow keys to move your shape generally close the desired position. During this process you may move the camera laterally, but you should not rotate the camera at all! The grid that TSRE uses while moving an object using the NumPad arrows is based on camera angle, so rotating it after placing an object will throw off subsequent objects, and they will not line up perfectly. At this point, this is what we should have:

[IMAGE]
image::images/Xing_1.jpg[]

<<<<
Step 2:: Place the second interactive - in this case, the flashers. Use the same method for moving the object as the first one. Once the flasher is in place, if there are no more `interactives` to be placed, you may move and rotate the camera freely. Another progress shot:

[IMAGE]
image::images/Xing_2.jpg[]

Step 3:: Now you can select both gate and flasher, or more if needed, as a group (Ctrl-Click each part) and move them into their final position. Typically you would set the rotation by copying rotational data from a road piece. Be sure to pick a level road piece, or your signal will be leaning. While you can't copy or paste rotational data from individual crossing objects, you can do this with groups of crossing objects. Once you do this you can use the `Copy Pos/Rot bottom` and instantly align any static parts that remain to be placed.

[IMAGE]
image::images/Xing_3.jpg[]

[NOTE]
If a crossing is on a track piece that extends from another tile, copying position won't work (copying rotation will still work). Attempting to use position copying will result in the static part disappearing (actually it teleports a mile or two away). The way to tell if this is a problem is to select one of the `interactives`. If one of the x- or z- coordinates is larger than 1024, it is on a track piece extending over a tile boundary. Up until now, we haven't had any problems with a crossing that is physically in one tile, but in another's .w file. However, when this is the case, we have to eyeball the static object placement. You can place objects with the crosshair on top of the mast, copy the y- coordinate from the mast shape, and then copy rotation data from the interactive shapes so it lines up (that still works on out-of-tile shapes).

[IMAGE]
image::images/Xing_4.jpg[]

<<<
===== Max Placing Radius

Did you plan on having your railroad grade crossing span every track in a wide area, but the orange cubes don't cover all of them? Do you want to make sure one railroad line's mileposts doesn't cover a parallel line that uses a different milepost measurement?

This is where the Max Placing Radius box comes into function. By default, it's set at 30. For the purpose of this tip, the Max Placing Radius function and it's text box are highlighted in red.

Here, we are attempting to place a railroad crossing gate at a wide multi-track crossing. Notice that the two furthest tracks aren't covered.

[IMAGE]
image::images/levelR1.png[]

Click on the text box below the Max Placing Radius text and change the value to an appropriate number. For this example we've changed the Max Placing Radius to 50 and this allows each track served by the crossing to be covered by the orange box.

[IMAGE]
image::images/levelR2.png[]

This little function should allow you to have proper massive-sized crossings and limited-track-reach mileposts, among other things.

<<<
==== Signals

*Linking Signals* 

1. Click 'Link' button.
2. Click 'Link Set' button.
3. Click on track 

[IMAGE]
image::images/signalLink1.png[]

[TIP]
  Be sure the pointer (cursor) is set to *Stick to Anything mode*. `Shift+Q` toggles the selection.

TSRE's method of linking signals is quite intuitive, but can be daunting for the uninitiated. Here are some lessons learned.


*Linking Signals for the Deviating Path*

1. Click 'Link' button.
2. Click 'Link Set'
3. Click between the straight and the deviating rail close to the root of the switch.

If the Link is set, the `text` in the button 'Link' will be written in `green` and the Fields near "From To" you will see numbers.

[WARNING]
You will have only one try to set this. If the 'Link' does not get set, you will need to start steps 1-3 over again.  Also, avoid moving the camera while doing these steps as this will also force you to start over.

<<<
===== Easy Junction

[IMAGE]
image::images/sig1.jpg[]

1. Locate pointer on the track and place the signal. A *red* marker and signal object appear. Flip with `X` if necessary.
2. Click the `Show list` button. 
3. Click the `Link Top Head` checkbox. A check in the box appears and the `Link` button enables.
4. Click the `Link` button. The `Set link` button enables. The fields are blank.
5. Click on the `Set link button.` 
6. Click the switch exit track you want linked. Junction data appears in the *Set Link* fields. 
7. Save 

*Explanation* 

*  Assuming you've placed your signal and know what you want linked, click on the button `Show List` on the left-hand side of the screen. A menu will pop up with all the signal's sub-objects on it. Select what you need. Note that unlike MSTS, you must actually click on the checkbox, rather than either the text or checkbox.
*  When you're ready to link a route, click the `Link` button for that sub-object, which should no longer be greyed-out now that that sub-object has been selected. When you press the `Link` button, the `Set Link` button should now read `Set Link [x]`, with `x` being the sub-object number assigned to it in the `sigcfg file`. That number is not otherwise indicated in the menu, but can be determined by counting from the top starting at 0 for the topmost one. In my case, it reads `Set Link [13]`.
*  When you have done this, click on the track where you want the link set. In my case it will be the diverging route. In the image below, a red arrow indicates where I clicked to set the link. If done right, a set of numbers will appear in the blanks in the SubObjLink info section next to the Set Link button. The two outside numbers will be switch or end-of-track nodes wich will be visible in TSRE. These can be used, especially in tight quarters, to make sure you got the right track linked.

[IMAGE]
image::images/sig2.jpg[]

<<<
===== Complex Junction

[IMAGE]
image::images/sig3.jpg[]

Use above steps, but when clicking on links, especially for double slips, these are best practices.
The red circle shows where I would link the through route on this switch. The *green* dotted line shows the *TSection* line for the through route, which will be a good guide to where to link that route. The blue circle shows where a diverging route can be selected on this switch. It works almost without fail, even in very tight spaces.

[IMAGE]
image::images/Link_areas.jpg[]

These guides will work on any switch, not just double slips.


==== Speedposts



==== Pickups 



==== Hazard Objects 



==== Soundsources 



==== Soundregions

To add sounds in TSRE,  go to "Object View" then in the right hand window under "Other" you will find "Sound Regions". 

Additionally, you can review the {or} Manual in section 13.3. This can automatically add sounds to curves and points. There is a link to download a set of sound files.  

Note: It was noticed that one of the sounds called for was not in the download. If you copy one of the files to be the missing file that was referenced, you can get it working. 

<<<

=== Editing Terrain

[TIP]
kbd:[Alt+V,H] will Toggle terrain view on and off. Handy for finding out what you might have "lost" below ground level.

==== Ace File Thumbnails

There is a 64bit ACE file viewer add-on available at:

http://koniec.org/MstsAceThumbnails_v1.zip

[IMAGE]
image::images/acefile1.png[]

[NOTE]
On Windows 7, UAC must be disabled.

1. Download and extract the files somewhere. Pick something that makes sense,  like where you installed *TSRE* or something you can remember, like `c:\bin`.

2. Open an command prompt and make sure you open it "as Administrator".

3. Go to the directory where the unzipped files are

4. Register the library using the command:

`Regsvr32.exe CppShellExtThumbnailHandler.dll`

Now all .ace files will have thumbnails like other images.

*REMOVAL*
If you want to remove it, unregister the library using the command:

`Regsvr32.exe /u CppShellExtThumbnailHandler.dll`

Once the removal step is performed, you can then delete the files.

[NOTE] 
This thumbnail library is only for 64 bit only



[IMAGE]
image::images/acefile2.png[]




==== How to edit terrain settings

Go to *Terrain Tools*. `Menu Tools->Terrain` or `F2`.

* Use `Fixed Height` button and click on tile if you want to reset its height map to fixed value.
* Use `Water level` button and click on tile if you want to set water level for tile.
* Use `Show/H Water` button and click on small tile if you want to show/hide water.
* Use `Show/H Tile` button and click on small tile if you want to show/hide it.

[TIP]
 If you want to show a hidden tile - click on its "line".

* If you want to make holes in terrain, use the `Gaps` button and click where you want it. You can use holes for tunnel entrances. If you want to fill the holes, show water first.

[TIP]
In TSRE, when laying track inside tunnels, use: kbd:[Shift + Q]. It will change the placement mode between "stick only to terrain" and "stick to everything". Then you will then be able to stick the new track to the existing track that is under the terrain.

[TIP]
Tunneling: ( Garry's method) My tunneling method is a bit unique, but easy. I make a copy of the tiles folder. Then each piece of track I lay I press F to mould the terrain to the track, turning the tunnel into a cutting. I can follow the track path on a map overlay, and when I get to the far end of the tunnel I can check the height, then go back and change the gradient until the track emerges at the correct height. Finally I replace the Tiles folder with the one I saved earlier.

[IMAGE]
image::images/rete5.png[]

==== Painting the Terrain Heightmap. 

* Go to *Terrain Tools*. `Menu Tools->Terrain` or kbd:[F2].
* Click `HeightMap` button.
* Click on terrain and paint using mouse.

If you want to switch between making mountains and valleys, press kbd:[Z]

[IMAGE]
image::images/rete1.png[]

You can adjust settings:

[IMAGE]
image::images/rete2.png[]

*A: Brush Size*

[IMAGE]
image::images/rete3.png[]

*B: Brush Intensity*

[IMAGE]
image::images/rete4.png[]

*C: Brush fixed height* - it is used if Brush type = Fixed Height. 

*D: Brush type*

* Add simple: current height += brush size {mult} brush intensity
* Add if inside size radius: current height += brush size {mult} brush intensity, but max value is brush size {mult} brush intensity
* Fixed height: set fixed height
* Flatten: make current height closer to average value

*For Fine Adjustments to terrain* 

* kbd:[F2] then Click on *HeightMap+* -> *Brush settings:* `Size=1`, `Intensity=1`(this is fine setting) 

* In the View Menu, Check `Terrain Grid` (it's easy when you can see the vertex's to position the cursor.) 

* The kbd:[Z] key toggles terrain vertex up/down. It make it VERY handy when sliding cursor around with mouse and left finger on kbd:[Z] key. 

Tapping left mouse does it. Sliding and painting with the cursor is really a nice feature, especially with larger brush (cursor) sizes. 

[WARNING]
  Beware of terrain gaps . . . you can loose stuff, it falls though the hole if you dragging... bye bye... it's a long way down. 

[TIP]
  For a very fine adjustment of terrain you can use a track or a road section or just about any object to adjust and/or flatten terrain. However some objects/shapes produce some very strange terrain sculpting. The kbd:[Ctrl+Z] key comes in handy here.


[WARNING]
----
Be careful when "painting" terrain. I am not sure how, but it appears brushing the tile to increase height might affect other tiles as well. Case in point, these spikes below which always appear after I have done terrain editing on adjacent tiles.

Perhaps using the "add if in radius" setting would avoid any unwanted artifacts like these being generated.

The example below is definitely not DEM artifacts
----
[IMAGE]
image::images/terrain artifacts.jpg[]

NOTE: Latest TSRE version should have resolved issues with these random spikes.

<<<

==== Painting Terrain Texture. 

Go to *Terrain Tools*. `Menu Tools->Terrain` or kbd:[F2].

*Putting textures on terrain:*

1. Find some textures and place them in `routeDirectory/terrtex`.
2. Click `Load` button and select your texture from terrtex directory.
3. Click `Put` and click on small tile you want place this texture. 
4. If you want to rotate the texture, click on small tile again.

You can use `Pick` button and pick a texture from the existing small tile instead of loading it from disk.

*Painting terrain textures:*

1. Pick or load texture you want to use as paint, or choose color from color window. 
2. Click `Texture` button if you want to paint using texture.
3. Click `Color` button if you want to paint using color.

[TIP]
  You can't lock small tile to avoid painting it by mistake.

[NOTE]
Remember that painted textures need a lot of memory and disk space. Use them in important locations only. For ground texture don`t forget to eventually compress with DXT1. It won't lose quality and will save space

[IMAGE]
image::images/rete6.png[]

This below is after spending 10 to 15 minutes work painting the Right of Way .

[IMAGE]
image::images/terrainpaint.jpg[]

*AutoPaint*

kbd:[F2] -> LOAD -> TEXTURE - Select Brush and Size

Use kbd:[CTRL] kbd:[LMB] on individual tracks to place Ballast under that selected piece or use mouse kbd:[RMB] and you will get the `AUTO PAINT` option and you can find a lit of items including the "Track Nodes" which will have the texture be applied under all track nodes that apply.



===== Some Painting Tips - Compression

Each painted texture is almost 1MB, because these textures are not compressed. The DXT compression method reduces the size of these to approx 1/8th of the original size. Compressing them individually isn't a solution if you extensively use this feature. Thousands of files are difficult to manage if you have to compress each of them one at a time.

*Route Riter* won't compress them to DXT, because it uses the *AceIt* tool, and the *AceIt* tool doesn't like the "-" prefix that these files have. You can make *AceIt* work for you though since it only has a problem if the output files have the "-" prefix. The get this to work, the output files need to be created without prefix and then you need to rename them afterward.

*One way to do it* 

It can be done with a text editor or Excel and the creation of some batch files. An example for a batch file:

----
aceit.exe -01a769f8_0_1.ace 01a769f8_0_1.ace /dxt /q
aceit.exe -01a769fc_0_4.ace 01a769fc_0_4.ace /dxt /q
aceit.exe -01a769fc_0_5.ace 01a769fc_0_5.ace /dxt /q
----

Notice the missing prefix at the output files.

After that, with another batch file You can rename them back to originals:

----
ren 01a769f8_0_1.ace -01a769f8_0_1.ace
ren 01a769fc_0_4.ace -01a769fc_0_4.ace
ren 01a769fc_0_5.ace -01a769fc_0_5.ace
----

You need something like Excel or a text editing program to create list of the commands.

You will also need a copy of `AceIt.exe` placed in the same folder, for simplicity sake.

*Additional tip:*

To generate a list of matching files from the command prompt:

`DIR /S /B /A:-D -*.ACE > myfiles.txt`


==== Auto Tile Generation

[IMAGE]
image::images/autotile1.png[]


1. Select marker file.
2. Select radius in tiles from marker file line.
3. Check if all height-map files are available.
4. Create whole terrain in one click.


[IMAGE]
image::images/autotile2.png[]

[IMAGE]
image::images/autotile3.png[]


<<<

==== Embankments, Cuttings and Road Height

Here you can adjust embankment settings. Look at this image: 

[IMAGE]
image::images/rete7.png[]

If you want to create embankment or cutting, select the track or road (it must be in TDB) and press kbd:[F].

===== Road/Terrain Adjustment

To adjust terrain under the road:

1. Click "View" at the top of the screen, and tick "Terrain Grid"
2. Press kbd:[F2] to get the terrain window on the right. Set "Size" and "Intensity" to `1`, "Height Type" to `Add-Simple`
3. Select the "HeightMap" button at the top (it turns light grey)
4. Mouse click repeatedly on the terrain junctions to adjust the terrain height. The keyboard kbd:[Z] key adjusts between up/down.

If the road piece is already in the rdb (or you just placed it without deselecting), just press the kbd:[F] key. This will raise the terrain under your road piece, but doesn't raise it everywhere else.



<<<

[#realistic]
=== Making Realistic Routes Using GEO Data

The Route Editor supports using several methods for making realistic routes easier. You can use:

* Marker Files
* Map Layers
* HGT terrain data import

[NOTE]
 If you are making an imaginary route, you can also skip this section.

==== Marker Files 

Current version of Route Editor supports three different types of marker files formats. It can take input from Traditional Marker Files (MKR), Google Earth Keyhole Markup Language (KML) files and Open Street Map (GPX) files.

1. MKR MSTS file http://msts.steam4me.net/tutorials/mkr_Googlemaps.html
2. KML file https://en.wikipedia.org/wiki/Keyhole_Markup_Language
3. GPX file https://en.wikipedia.org/wiki/GPS_Exchange_Format

[NOTE]
  The original MKR files are the legacy method of placement references used with the MSTS Route Editor.  This is by far the most common method used when creating MSTS routes, however, with TSRE5  everyone should use *KML* or *GPX* methods instead.

[TIP]
Another handy tool when routebuilding is GPS visualizer: https://www.gpsvisualizer.com/




===== How to create KML/GPX format files

You can use http://www.gpsvisualizer.com/draw/
This site allows you to draw points and paths on a large number of map layers, including the Google Maps Satellite images. 

Using the *GPS Visualizer* website is very simple. 


Use the Button labeled WPT draw individual waypoints used to define specific locations
Use the Button labeled TRK to draw long segmented paths for roads or tracks.

[IMAGE]
image::images/reg2.png[]

Draw some way-points and continuos paths

Click on the appropriate button to choose a file type (GPX or KML). Selecting the button will change the file type to be downloaded.  A download link will appear and clicking it will allow you to download the generated file to your computer.

[IMAGE]
image::images/reg4.png[]


Place the downloaded file into the working directory of the route being worked on.

[IMAGE]
image::images/reg5.png[]

* In the *Navi Window*, use the pulldown bar to select your file.
* You can select a file item and then seect the `Jump` button to go to desired position.
* Click menu `View->Markers` to show selected file items. 

[IMAGE]
image::images/reg6.png[]

<<<

==== Map Layers 

Using a _Map layer_ is a better and faster solution than using marker files if you want to create realistic route.

* Go to *Geo Tools*. Menu `Tools->Geo` or press kbd:[F3].
* Click `Load Map` button.
* Find Tile you want to load map layer and click on it.
* In new window click `Load` and wait until map layer download is complete.

You can choose between bright and dark colors.

[IMAGE]
image::images/reg7.png[]

* Close the window.
* Click `Show/H Map` button.
* Find Tile you want to show map layer and click on it.

[IMAGE]
image::images/reg8.png[]

[WARNING] 
    Don't load too many Tile maps at once.

<<<

==== HGT terrain data import 

HGT terrain data import allows you to easily create realistic terrain. The easiest to use place I have found to *find* the HGT data files is below.

http://dwtkns.com/srtm30m/

NOTE: While this web page will let you *find* the DEM (Height) data that you want... and allow you to have the DOWNLOAD link for this data, you still need to have a (free) account with HTTP://urs.earthdata.nasa.gov to actually download them.  So... first things first... get your free account at  https://urs.earthdata.nasa.gov/users/new  Registration Page.  Any web based instructions older than 2016 might not tell you need to also have a free account to use  these sites. 

The downloaded data will be in inside ZIP files.

Nasa also has a web page: https://earthexplorer.usgs.gov/  but my opinion is that it is less user-friendly to use as the first link above. I'm not even going to explain how to get DEM data from this site... I leave that up to the reader.

[TIP]
 With Earth Explorer, I believe that you want to locate the results that contain the NASA LPDAAC Collections -> NASA SRTM -> SRTM -> NASA SRTMGL30 database. ( I have not done this personally)

[WARNING]
The link provided in the Official TSRE5 website no longer works.

1. Set *geoPath* in settings to directory where you have your HGT files. _See: <<settings>>_
2. Go to *Geo Tools*. Menu `Tools->Geo` or kbd:[F3].
3. Click `Load Height` button.
4. Find Tile you want to load terrain data and click on it.
5. In new window click `Load` button.

If a proper HGT file doesn't exist, a message box will tell you name of the file you need to download. Close {RE} and download the missing files.

[IMAGE]
image::images/reg9.png[]

* Close the window.
* Enjoy realistic terrain.

[IMAGE]
image::images/reg10.png[]



===== Example session - Adding a tile with terrain:

Add a tile to existing route by jumping to the location of where you want to add a tile. 

* Push the kbd:[B] key. Tile is created and the quad tree updated. 
* Push kbd:[F2] to load Terrain tools menu. 
* Push `Height` button and push `LOAD` button in the window. The "Hgt" data for that tile is located and loaded, provided that the hgt files are downloaded and saved in the location pointed to by what is in `settings.txt`. 
* Save. 

There is now a new tile with terrain in the route. 

	
===== Some Additional Internet Links for .hgt Files.

These are subject to change and may stop working...

http://viewfinderpanoramas.org/Coverage%20map%20viewfinderpanoramas_org3.htm

https://dds.cr.usgs.gov/srtm/version2_1/SRTM3/

https://search.earthdata.nasa.gov/search/granules/collection-details?p=C1000000240-LPDAAC_ECS&m=18.984375!-10.40625!2!1!0!&tl=1098377168!6!!



<<<

==== Using Satellite Images

===== Google Maps

Using this feature requires Google maps api key. Without it sooner or later you will see gray image instead of satellite view.  

1. Create Google maps api key.
2. Enable static maps for your key.
3. Place key in `settings.txt`. Example below:

`GoogleMapsKey = Key Goes Here`

To get your own Google Maps API Key, use this link: https://developers.google.com/maps/documentation/javascript/get-api-key


[NOTE]
Google Maps changed how API keys are administered and are "technically" no longer free since you need to provide a way for them to bill you in case you exceed their usage guidelines for each service.  _An alternative to Google Maps API has also been implemented._


===== Mapbox

Mapbox provide not just a vector street map also an satellite images.

http://www.Mapbox.com

1.  Register and obtain your API KEY.
2.  Once you obtain your API KEY, open the *TSRE* `settings.txt` file and alter *imageMapsURL* line with the following code:

----
imageMapsUrl = http://api.mapbox.com/v4/mapbox.satellite/{lon},{lat},{zoom}/{res}x{res}.png?access_token=INSERT_YOUR_API_KEY_HERE
----

Example:

[IMAGE]
image::images/mapbox1.jpg[]

[WARNING]
You might find that using these map projections for Japan are problematic,however for Europe and America it works well...

<<<

==== Distant Mountains  
(Supplied by Renzo Grassi & Giuseppe Ptrains)

[NOTE]
This section is related to TSRE5 from version 0.698 onwards. 

[WARNING]
This Distant Mountains solution is only compatible with Open Rails and will not work in Microsoft Train Simulator routes.


===== General Workflow

[ditaa]

....

+-------------------+    +---------------+    +------------+    +-----------------+    +-----------------+
| Download relevant |    | Update        |    | Load Route |    | Change EDIT Mode|    | Use HGT files   |
| GEO Height Data   |--->| SETTINGS.TXT  |--->| in         |--->| to              |--->| to generate     |
| & Unpack it       |    | with GEODATA  |    | TSRE       |    | Distant Terrain |    | Distant Terrain |
+-------------------+    +---------------+    +------------+    +-----------------+    +-----------------+
....

As a first step, it is necessary to download the geographical data of the area to be produced. There are several websites that allow you to download `geodata`. 

Examples were downloaded from: http://www.viewfinderpanoramas.org/dem3.html, a site which contains geodata from different parts of the world at a resolution of 3" (almost) all over the world. They are files in `.hgt` format. 

[TIP]
To locate alternate `geodata` sources, you only need to do a Google search and enter "geodata hgt" as the search criteria. 


==== Setup 

Once the `geodata` you require has been downloaded to your PC, you need to edit the `settings.txt` file in the `TSRE5` folder and search for  the *geoPath* entry. This entry defines the "path" to the folder containing the downloaded `geodata`, for example: `geoPath = c:\train\MSTS\DEM\dem90m\SRTM`

For more information, refer to the *HGT terrain data import* section of this document.


==== Editing

At this point, the preparations are complete and we can start `TSRE5` and open the route in which we want to add the distant mountains. Once it is loaded in the main window, choose `Settings -> Terrain Editing: -> Distant Terrain` from the top menu. 

[IMAGE]
image::images/DistantMountTSre5.png[]

[TIP]
To return to normal terrain editing so you once again see the terrain of the route, simply select the item `Settings -> Terrain Editing: -> Detailed Terrain`. 

Once the `Distant Terrain` option is selected, the standard terrain will disappear and TSRE will display the current Distant Mountain settings, and these don't exist yet.  

[IMAGE]
image::images/DistantMountTSre5-2.png[]

The right side `Tools` options menu normally contains the objects we must select.  We need the `Geo` window tools options and 
we reach it by either opening the menu at the top under `Tools` or by pressing the kbd:[F3] key.

To create a new tile, press the kbd:[B] key and a window will open asking whether or not to create a 
new tile. Answer: "Yes". 

[IMAGE]
image::images/DistantMountTSre5-3.png[]

It will say that the tile exists and if we want to overwrite it, again Answer: "YES".

_next section of text needs some clarification_ 

The new tile just created is much larger than those of the normal terrain (which have the side of 2 km) and if, as in the figure below, we are close to the edge of the tile, once you have finished fixing this, it is sufficient to move to the area white and repeat the creation procedure from button B onwards. 

[IMAGE]
image::images/DistantMountTSre5-4.png[]

In the `Geo` window, which we opened by pressing kbd:[F3], we must now press the `Load Height` button and 
with the left mouse button click on a portion of the created tile to select it. 

A new black window opens, press the big `Load` button at the top and an image of the mountainous 
reliefs of the area will appear. 

[IMAGE]
image::images/DistantMountTSre5-5.png[]

If this does not happen, check that you have correctly entered the path to the `geodata` folder and that the `hgt` file covering that part of the territory is present. 
Once this is done you can close the window and the new tile will show the view of the area. 

[IMAGE]
image::images/DistantMountTSre5-6.png[]

[]
Before leaving the editor, remember to save your work. 








